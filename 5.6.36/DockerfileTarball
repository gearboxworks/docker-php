FROM alpine:3.7

MAINTAINER Gearbox Team <team@gearbox.works>

ARG PACKAGE_VERSION="5.6.36"
ARG PACKAGE_URL="http://php.net/get/php-5.6.36.tar.gz/from/this/mirror"
ARG PACKAGE_ROOT="/"
ARG GEARBOX_USER="gearbox"
ARG GEARBOX_UID="1000"
ARG GEARBOX_GROUP="gearbox"
ARG GEARBOX_GID="1000"


################################################################################
ENV BASE_BUILD $BASE_BUILD
ENV PACKAGE_VERSION $PACKAGE_VERSION
ENV PACKAGE_URL $PACKAGE_URL
ENV PACKAGE_ROOT $PACKAGE_ROOT
ENV GEARBOX_USER $GEARBOX_USER
ENV GEARBOX_UID $GEARBOX_UID
ENV GEARBOX_GROUP $GEARBOX_GROUP
ENV GEARBOX_GID $GEARBOX_GID

USER root

COPY build/* /build/
COPY container.json /etc/container.json
COPY files /
COPY tarball /tmp

RUN cd / && tar xf /tmp/tarball && /bin/sh /build/cleanup.sh && rm /tmp/tarball && mkdir /run/php

WORKDIR /project/www
# USER gearbox
# ENTRYPOINT ["/usr/local/bin/php-entrypoint"]
CMD ["/usr/sbin/php-fpm", "-F"]
